<%- include('../partials/head.ejs') %>
<style>
    /* 1. ĐỒNG BỘ BIẾN HỆ THỐNG */
    :root {
        --sidebar-width: 240px;
        --admin-bg: #f0f0f1;
        --sidebar-bg: #23282d;
        --base-font: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;
    }

    body { 
        margin: 0; padding: 0; 
        background-color: var(--admin-bg); 
        font-family: var(--base-font);
        font-size: 14px; /* Font size chuẩn CMS */
        color: #3c434a;
    }

    /* 2. ĐỒNG BỘ LAYOUTwrapper */
    .admin-wrapper { display: flex; min-height: 100vh; }
    
    .admin-sidebar-container {
        width: var(--sidebar-width);
        position: fixed;
        top: 0; left: 0; bottom: 0;
        background-color: var(--sidebar-bg);
        z-index: 1000;
    }
    
    .admin-content {
        flex: 1;
        margin-left: var(--sidebar-width); /* Khớp tuyệt đối với sidebar */
        padding: 30px;
        min-width: 0;
    }

    /* 3. ĐỒNG BỘ CARD & COMPONENT */
    .wp-card { 
        background: #fff; 
        border: 1px solid #c3c4c7; 
        box-shadow: 0 1px 1px rgba(0,0,0,.04); 
        padding: 25px; 
        margin-bottom: 25px; 
        border-radius: 2px;
    }
    
    .card { border: 1px solid #c3c4c7; border-radius: 2px; }
    
    .wp-badge-primary { border-left: 4px solid #2271b1; }
    .wp-badge-success { border-left: 4px solid #00a32a; }

    /* Fix font cho các thẻ tiêu đề */
    h2, h4, h5, h6 { color: #1d2327; font-weight: 700; }
    .display-4 { font-size: 2.5rem; }

    @media (max-width: 992px) {
        .admin-sidebar-container { display: none; }
        .admin-content { margin-left: 0; padding: 15px; }
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="admin-wrapper">
        <div class="admin-sidebar-container">
            <%- include('./partials/sidebar.ejs') %>
        </div>

        <div class="admin-content">
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
                    <h2 class="fw-bold h4 mb-0">Bảng tin CMS</h2>
                    <span class="text-muted small"><i class="far fa-calendar-alt me-1"></i> Hôm nay: <%= new Date().toLocaleDateString('vi-VN') %></span>
                </div>

                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="wp-card p-3 wp-badge-primary mb-0">
                            <div class="text-muted small fw-bold text-uppercase">Bài viết</div>
                            <div class="fs-2 fw-bold my-1"><%= totalPosts %></div>
                            <a href="/admin/posts" class="small text-decoration-none text-primary">Quản lý bài viết <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="wp-card p-3 wp-badge-success mb-0">
                            <div class="text-muted small fw-bold text-uppercase">Sản phẩm</div>
                            <div class="fs-2 fw-bold my-1"><%= totalProducts %></div>
                            <a href="/admin/products" class="small text-decoration-none text-success">Quản lý kho hàng <i class="fas fa-arrow-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                <div class="wp-card border-top border-4 border-dark">
                    <h5 class="fw-bold mb-3"><i class="fas fa-rocket me-2 text-primary"></i>Bắt đầu nhanh</h5>
                    <p class="text-secondary mb-4">Chào mừng bạn quay trở lại. Hệ thống đã sẵn sàng để bạn cập nhật nội dung mới.</p>
                    <div class="d-flex gap-2">
                        <a href="/admin/add-post" class="btn btn-primary btn-sm px-4 fw-bold">Viết bài mới</a>
                        <a href="/admin/add-product" class="btn btn-outline-dark btn-sm px-4 fw-bold">Thêm sản phẩm</a>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="wp-card border-top border-4 border-primary h-100">
                            <h6 class="fw-bold text-uppercase small mb-4">Sức khỏe SEO tổng thể</h6>
                            <div style="max-width: 200px; margin: 0 auto;">
                                <canvas id="seoChart"></canvas>
                            </div>
                            <div class="mt-4 small">
                                <div class="d-flex justify-content-between mb-2">
                                    <span><i class="fas fa-circle text-success me-2"></i>Tốt</span>
                                    <span class="fw-bold"><%= seoData[0] %></span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span><i class="fas fa-circle text-warning me-2"></i>Ổn</span>
                                    <span class="fw-bold text-dark"><%= seoData[1] %></span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span><i class="fas fa-circle text-danger me-2"></i>Cần tối ưu</span>
                                    <span class="fw-bold"><%= seoData[2] %></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="wp-card bg-primary text-white text-center py-4 mb-0">
                                    <div class="display-4 fw-bold"><%= totalPosts %></div>
                                    <p class="text-uppercase small mb-0 opacity-75 fw-bold">Bài viết Blog</p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="wp-card bg-info text-white text-center py-4 mb-0">
                                    <div class="display-4 fw-bold"><%= totalProducts %></div>
                                    <p class="text-uppercase small mb-0 opacity-75 fw-bold">Sản phẩm Shop</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="wp-card">
                            <h6 class="fw-bold small text-uppercase mb-3">Lối tắt hệ thống</h6>
                            <div class="list-group list-group-flush small">
                                <a href="/admin/settings" class="list-group-item list-group-item-action py-3 px-0 border-bottom">
                                    <i class="fas fa-code me-3 text-muted"></i>Cấu hình Script Header/Footer
                                </a>
                                <a href="/admin/pages" class="list-group-item list-group-item-action py-3 px-0 border-bottom">
                                    <i class="fas fa-file-alt me-3 text-muted"></i>Quản lý các trang tĩnh
                                </a>
                                <a href="/admin/customize" class="list-group-item list-group-item-action py-3 px-0 border-0">
                                    <i class="fas fa-paint-brush me-3 text-muted"></i>Tùy biến giao diện (Theme)
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('seoChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Tốt', 'Ổn', 'Cần tối ưu'],
                    datasets: [{
                        data: [<%= seoData[0] %>, <%= seoData[1] %>, <%= seoData[2] %>],
                        backgroundColor: ['#00a32a', '#ffb900', '#d63638'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    plugins: {
                        legend: { display: false }
                    },
                    cutout: '78%',
                    maintainAspectRatio: false
                }
            });
        });
    </script>
</body>
</html>