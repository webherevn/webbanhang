<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <% 
        // 1. LOGIC SEO & THEME SETTINGS
        let currentItem = (typeof post !== 'undefined') ? post : ((typeof product !== 'undefined') ? product : ((typeof page !== 'undefined') ? page : null));
        let siteTheme = (typeof theme !== 'undefined' && theme) ? theme : {};

        let finalTitle = (currentItem && currentItem.seoTitle) ? currentItem.seoTitle : (typeof pageTitle !== 'undefined' ? pageTitle : "Fashion Store");
        
        let rawDesc = (currentItem && currentItem.seoDescription) ? currentItem.seoDescription : 
                      ((currentItem && currentItem.summary) ? currentItem.summary : 
                      (siteTheme.topBarText || "Chuyên cung cấp sản phẩm thời trang cao cấp."));
        
        let finalDesc = rawDesc.replace(/<[^>]*>?/gm, '').substring(0, 160);
        let finalImage = (currentItem && currentItem.thumbnail) ? currentItem.thumbnail : (siteTheme.logo || "/images/default-share.jpg");
        let domain = "https://webbanhang-es90.onrender.com"; 
    %>

    <title><%= finalTitle %></title>
    <meta name="description" content="<%= finalDesc %>">
    <link rel="canonical" href="<%= domain %><%= typeof path !== 'undefined' ? path : '' %>">

    <% if (siteTheme.favicon) { %>
        <link rel="icon" type="image/x-icon" href="<%= siteTheme.favicon %>">
    <% } else { %>
        <link rel="icon" type="image/png" href="/images/favicon.png">
    <% } %>

    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= domain %><%= typeof path !== 'undefined' ? path : '' %>">
    <meta property="og:title" content="<%= finalTitle %>">
    <meta property="og:description" content="<%= finalDesc %>">
    <meta property="og:image" content="<%= finalImage %>">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <% if (typeof globalScripts !== 'undefined' && globalScripts.headerScripts) { %>
        <%- globalScripts.headerScripts %>
    <% } %>

    <style>
        :root {
            --primary-font: 'Montserrat', sans-serif;
            --sidebar-width: 260px; /* Chiều rộng sidebar cố định */
            --admin-bg: #f0f0f1;
            --wp-blue: #2271b1;
            --sidebar-bg: #23282d;
            --base-font-size: 14px; /* Font size chuẩn WordPress CMS */
        }
        body { 
            background-color: #fff; /* Đổi thành trắng cho đúng chất Shop thời trang */
            font-family: var(--primary-font);
            font-size: var(--base-font-size);
            color: #333;
            margin: 0; padding: 0;
        }
        
        /* Hiệu ứng Animation cho Hero Section */
        .animate-up {
            opacity: 0;
            transform: translateY(30px);
            animation: moveUp 0.8s ease forwards;
        }
        @keyframes moveUp {
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* === [CẬP NHẬT MỚI] CSS CHO MENU ĐA CẤP (DROPDOWN SUBMENU) === */
        /* Mũi tên chỉ sang phải cho item có con */
        .dropdown-menu .dropdown-item-has-child > a {
            position: relative;
            padding-right: 30px; /* Chừa chỗ cho mũi tên */
        }
        .dropdown-menu .dropdown-item-has-child > a::after {
            content: "\f054"; /* FontAwesome right arrow */
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            opacity: 0.5;
        }

        /* Menu cấp 3 hiện ra bên cạnh (Flyout) */
        .dropdown-menu .dropdown-submenu {
            display: none;
            position: absolute;
            left: 100%;
            top: -8px; /* Căn chỉnh lại cho khớp mép trên */
            margin-left: 0.1rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            border-radius: 0.25rem;
            min-width: 200px;
            background: #fff;
            padding: 0.5rem 0;
            list-style: none;
            z-index: 1000;
        }

        /* Hover vào cấp 2 thì hiện cấp 3 */
        .dropdown-menu .dropdown-item-has-child:hover > .dropdown-submenu {
            display: block;
        }

        /* Mobile responsive: Trên mobile thì hiện thụt dòng xuống dưới */
        @media (max-width: 991px) {
            .dropdown-menu .dropdown-submenu {
                position: static;
                display: block; /* Luôn hiện hoặc dùng JS toggle */
                margin-left: 20px;
                box-shadow: none;
                border-left: 2px solid #eee;
                padding-left: 10px;
            }
            .dropdown-menu .dropdown-item-has-child > a::after {
                display: none; /* Ẩn mũi tên trên mobile cho gọn */
            }
        }
        /* ========================================================== */

        /* Sidebar cố định */
        .admin-sidebar-container {
            width: var(--sidebar-width);
            position: fixed;
            top: 0; left: 0; bottom: 0;
            background-color: var(--sidebar-bg);
            z-index: 1000;
            overflow-y: auto;
        }

        /* Nội dung chính bên phải */
        .admin-content {
            flex: 1;
            margin-left: var(--sidebar-width); /* Luôn khớp với sidebar */
            padding: 30px;
            min-width: 0; /* Tránh vỡ layout trên màn hình nhỏ */
        }

        /* Đồng bộ Font size cho toàn bộ thẻ trong Admin */
        .admin-content h2, .admin-content h4 { font-weight: 700; color: #1d2327; }
        .admin-content label { font-size: 13px; font-weight: 600; margin-bottom: 5px; display: block; }
        .admin-content .form-control, .admin-content .btn { font-size: 14px; }
        
        /* Responsive Admin */
        @media (max-width: 992px) {
            .admin-sidebar-container { transform: translateX(-100%); transition: 0.3s; }
            .admin-content { margin-left: 0; padding: 15px; }
        }

        /* Tối ưu ảnh sản phẩm cho đều nhau */
        .product-img {
            aspect-ratio: 3/4;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .product-card:hover .product-img {
            transform: scale(1.05);
        }
        
        .letter-spacing-2 { letter-spacing: 2px; }

        /* === CSS MENU ĐA CẤP (QUAN TRỌNG) === */
    
    /* 1. Xử lý cho Desktop (Màn hình lớn hơn 992px) */
    @media (min-width: 992px) {
        
        /* Tự động hiện menu khi Hover vào Cấp 1 */
        .navbar-nav .dropdown:hover > .dropdown-menu {
            display: block;
            margin-top: 0; /* Xóa khoảng cách để chuột không bị hụt */
        }

        /* Tự động hiện menu Cấp 3 khi Hover vào Cấp 2 */
        .dropdown-menu .dropdown-item-has-child:hover > .dropdown-submenu {
            display: block;
        }

        /* Định vị Menu Cấp 3 bay sang phải */
        .dropdown-menu .dropdown-submenu {
            display: none; /* Mặc định ẩn */
            position: absolute;
            left: 100%; /* Đẩy sang bên phải 100% chiều rộng cha */
            top: -5px;  /* Căn chỉnh lại mép trên */
            margin-left: 0;
            border-radius: 0.25rem;
            background-color: #fff;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            min-width: 200px;
            list-style: none;
            padding: 0.5rem 0;
            border: 1px solid rgba(0,0,0,.15);
        }

        /* Mũi tên chỉ sang phải cho item có con */
        .dropdown-menu .dropdown-item-has-child > a {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dropdown-menu .dropdown-item-has-child > a::after {
            content: "\f054"; /* FontAwesome Right Arrow */
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            font-size: 10px;
            opacity: 0.5;
        }
    }

    /* 2. Xử lý cho Mobile (Màn hình nhỏ) */
    @media (max-width: 991px) {
        /* Trên mobile thì không bay ngang mà thụt dòng */
        .dropdown-menu .dropdown-submenu {
            display: none; /* Mặc định ẩn, dùng JS hoặc CSS click để hiện nếu muốn */
            position: static;
            margin-left: 20px;
            box-shadow: none;
            border-left: 2px solid #eee;
        }
        /* Trên mobile cho hiện luôn để dễ bấm (hoặc dùng JS toggle) */
        .dropdown-menu .dropdown-item-has-child .dropdown-submenu {
            display: block; 
        }
    }

        /* Giữ lại style admin nếu bạn dùng chung file head */
        .admin-wrapper { display: flex; min-height: 100vh;}
        
        <% if (siteTheme.customCss) { %>
            <%- siteTheme.customCss %>
        <% } %>
    </style>
</head>