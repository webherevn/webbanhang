<%- include('../../partials/head.ejs') %>
<div class="admin-wrapper">
    <div class="admin-sidebar-container"><%- include('../../partials/sidebar.ejs') %></div>
    
    <div class="admin-content">
        <form action="/admin/homepage/edit-section" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="sectionId" value="<%= section._id %>">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="/admin/homepage/builder">Thiết kế</a></li>
                        <li class="breadcrumb-item active">Chỉnh sửa khối <%= section.type %></li>
                    </ol>
                </nav>
                <div class="d-flex gap-2">
                    <a href="/admin/homepage/builder" class="btn btn-light rounded-pill px-4">Hủy bỏ</a>
                    <button type="submit" class="btn btn-primary rounded-pill px-4 shadow">
                        <i class="fas fa-save me-2"></i>Lưu cấu hình
                    </button>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-7">
                    <div class="wp-card mb-4 border-top border-primary border-4">
                        <h5 class="fw-bold mb-4 border-bottom pb-3">Nội dung văn bản</h5>
                        
                        <div class="mb-4">
                            <label class="form-label fw-bold small text-uppercase">Tiêu đề chính (Heading)</label>
                            <input type="text" name="title" class="form-control form-control-lg border-2" value="<%= section.data.title %>">
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold small text-uppercase">Tiêu đề phụ (Subtitle)</label>
                            <input type="text" name="subtitle" class="form-control border-2" value="<%= section.data.subtitle %>">
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold small text-uppercase">Tên nút bấm</label>
                                <input type="text" name="buttonText" class="form-control" value="<%= section.data.buttonText %>">
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-bold small text-uppercase">Đường dẫn nút (Link)</label>
                                <input type="text" name="buttonLink" class="form-control" value="<%= section.data.buttonLink %>" placeholder="/shop">
                            </div>
                        </div>
                    </div>

                    <% if (section.type === 'features') { %>
                        <div class="wp-card">
                            <h5 class="fw-bold mb-4 border-bottom pb-3">Cấu hình các Items</h5>
                            <div id="items-wrapper">
                                <% (section.data.items || []).forEach((item, index) => { %>
                                    <div class="item-entry p-3 bg-light border rounded mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="badge bg-secondary">Item #<%= index + 1 %></span>
                                        </div>
                                        <div class="row g-2">
                                            <div class="col-md-4">
                                                <input type="text" name="items[<%= index %>][icon]" class="form-control form-control-sm" placeholder="Icon (bi-truck)" value="<%= item.icon %>">
                                            </div>
                                            <div class="col-md-8">
                                                <input type="text" name="items[<%= index %>][title]" class="form-control form-control-sm" placeholder="Tên dịch vụ" value="<%= item.title %>">
                                            </div>
                                            <div class="col-12 mt-2">
                                                <textarea name="items[<%= index %>][desc]" class="form-control form-control-sm" placeholder="Mô tả ngắn"><%= item.desc %></textarea>
                                            </div>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        </div>
                    <% } %>
                </div>

                <div class="col-lg-5">
                    <div class="wp-card mb-4 bg-dark text-white">
                        <h5 class="fw-bold mb-4 border-bottom border-secondary pb-3">Hình ảnh đại diện</h5>
                        <% if(section.data.bgImage) { %>
                            <div class="position-relative mb-3 rounded overflow-hidden shadow-lg">
                                <img src="<%= section.data.bgImage %>" class="w-100" style="max-height: 250px; object-fit: cover;">
                            </div>
                        <% } %>
                        <div class="mb-2">
                            <label class="form-label small fw-bold">Tải ảnh mới</label>
                            <input type="file" name="bgImage" class="form-control form-control-sm bg-secondary text-white border-0">
                        </div>
                        <p class="text-secondary small mt-2">Định dạng hỗ trợ: JPG, PNG, WEBP. Dung lượng tối đa: 2MB.</p>
                    </div>

                    <div class="wp-card">
                        <h5 class="fw-bold mb-3">Hiển thị</h5>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="activeToggle" checked>
                            <label class="form-check-label fw-bold" for="activeToggle">Kích hoạt khối này</label>
                        </div>
                        <hr>
                        <p class="text-muted small"><i class="fas fa-info-circle me-1"></i> Khối này sẽ xuất hiện trên trang chủ ngay sau khi bạn nhấn Lưu thay đổi.</p>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>