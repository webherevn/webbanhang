<% 
  if (typeof theme === 'undefined') { var theme = {}; } 
%>

<% if (theme.topBarShow) { %>
    <div class="top-bar py-2 text-center text-white" 
         style="background-color: <%= theme.topBarBgColor || '#23282d' %>; font-size: 14px; letter-spacing: 0.5px;">
        <div class="container"><%- theme.topBarText %></div>
    </div>
<% } %>

<nav class="navbar navbar-expand-lg navbar-light bg-white <%= theme.headerSticky ? 'sticky-top' : '' %> shadow-sm py-3">
    <div class="container">
        <a class="navbar-brand fw-bold fs-3 text-uppercase tracking-wide" href="/">
            <% if (theme.logo) { %>
                <img src="<%= theme.logo %>" alt="Site Logo" style="max-height: 50px; width: auto;">
            <% } else { %>
                FASHION<span class="text-danger">.</span>
            <% } %>
        </a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            
            <ul class="navbar-nav mx-auto mb-2 mb-lg-0 fw-semibold">
                <% if (typeof mainMenu !== 'undefined' && mainMenu.length > 0) { %>
                    <% mainMenu.forEach(level1 => { %>
                        
                        <% if (level1.children && level1.children.length > 0) { %>
                            
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="<%= level1.link %>" 
                                   id="navbarDropdown<%= level1._id %>" 
                                   role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <%= level1.name %>
                                </a>
                                
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown<%= level1._id %>">
                                    <% level1.children.forEach(level2 => { %>
                                        
                                        <% if (level2.children && level2.children.length > 0) { %>
                                            
                                            <li class="dropdown-item-has-child position-relative">
                                                <a class="dropdown-item" href="<%= level2.link %>">
                                                    <%= level2.name %>
                                                </a>
                                                
                                                <ul class="dropdown-submenu">
                                                    <% level2.children.forEach(level3 => { %>
                                                        <li>
                                                            <a class="dropdown-item" href="<%= level3.link %>">
                                                                <%= level3.name %>
                                                            </a>
                                                        </li>
                                                    <% }) %>
                                                </ul>
                                            </li>

                                        <% } else { %>
                                            <li><a class="dropdown-item" href="<%= level2.link %>"><%= level2.name %></a></li>
                                        <% } %>

                                    <% }) %>
                                </ul>
                            </li>
                        
                        <% } else { %>
                            <li class="nav-item">
                                <a class="nav-link <%= (typeof currentPath !== 'undefined' && currentPath === level1.link) ? 'active text-danger' : '' %>" 
                                   href="<%= level1.link %>">
                                    <%= level1.name %>
                                </a>
                            </li>
                        <% } %>

                    <% }) %>
                <% } else { %>
                    <li class="nav-item"><a class="nav-link" href="/">Trang chủ</a></li>
                    <li class="nav-item"><a class="nav-link" href="/products">Sản phẩm</a></li>
                <% } %>
            </ul>
            <div class="d-flex align-items-center gap-3">
                <a href="#" class="text-dark fs-5"><i class="bi bi-search"></i></a>
                <a href="/cart" class="text-dark fs-5 position-relative">
                    <i class="bi bi-bag"></i>
                    <% if (typeof cart !== 'undefined' && cart && cart.totalQuantity > 0) { %>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6rem;">
                            <%= cart.totalQuantity %>
                        </span>
                    <% } %>
                </a>
            </div>
        </div>
    </div>
</nav>

<% if (theme.headerBottomHtml) { %>
    <div class="header-bottom-custom border-bottom bg-light">
        <div class="container py-2 text-center"><%- theme.headerBottomHtml %></div>
    </div>
<% } %>